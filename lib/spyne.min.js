!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ramda"),require("rxjs")):"function"==typeof define&&define.amd?define("spyne",["ramda","rxjs"],t):"object"==typeof exports?exports.spyne=t(require("ramda"),require("rxjs")):e.spyne=t(e.R,e.Rx)}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t,r){e.exports=r(5)},function(e,t,r){"use strict";r.r(t);var n=r(0),i=function(e){if(void 0!==e.constructor.name)return e.constructor.name;var t=e.toString();return n.defaultTo(String(t).substr(0,12),n.match(/^(function\s)(\w+)(\(.*)$/,t)[2])},o=function(e,t){if(void 0!==e[t])return t;return n.compose(n.head,n.filter(n.compose(n.test(n.__,t),function(e){return new RegExp(e)})))(n.keys(e))},a=function(e){var t={};for(var r in e)t[r]=e[r];return t},s=function e(t){return{map:function(r){return e(r(t))},fold:function(e,r){return r(t)},inspect:function(){return"right("+t+")"}}},c=function(e,t){return n.isNil(e)?t:e},u=function e(t){return{map:function(r){return e(t)},fold:function(e,r){return e(t)},inspect:function(){return"left("+t+")"}}},d=function(e){var t=n.compose(n.complement(n.isEmpty),n.head,n.values),r=n.compose(n.complement(n.isNil),n.head,n.values);return n.allPass([t,r])(e)},h=function(e,t,r){void 0===r&&(r=null);var n=e[t];return n?s(n):u(r)},l=function(e,t){void 0===e&&(e=void 0),void 0===t&&(t=[]);t=n.concat(["length","name","prototype","constructor"],t);var r=n.compose(n.without(t),n.uniq),i=r(Object.getOwnPropertyNames(e.constructor.prototype)),o=r(function(e,t){return void 0===e&&(e=void 0),void 0===t&&(t=[]),Object.getOwnPropertyNames(e)}(e.constructor));return{methods:i,staticMethods:o,allMethods:n.concat(i,o)}},p=r(0),m=r(1),f=function(){return{includes:function(){return void 0!==window.Spyne?(e=window.Spyne.channels.map,t=[],n.forEach(function(e,r,n){return t.push(r)},e),t):["ROUTE","UI","WINDOW","DISPATCHER"];var e,t}}},v=["LOAD","RENDER","MOUNT","UNMOUNT","DISPOSE","GARBAGE_COLLECT","UPDATE"],E=["parent","self","child","children","view"],b=["Observable","BehaviorSubject","Subject","Observer","Subscriber","FromEventObservable"],y=["subscribe","combineLatest"],N=[],S=[],A=[],g=[],T=[],_=[];if(void 0!==p&&void 0!==m){N=[{error:"need to match a valid name within "+b,predicate:function(e){return f().includes(e.name)}},{error:"param 'observable' must contain a valid Rx.Observable",predicate:function(e){return void 0!==e.observable.subscribe}},{error:"param action must be a registered action",predicate:function(e){return y.includes(e.action)}}],S=[{error:"needs cid number in srcElement",predicate:p.compose(p.is(String),p.path(["data","srcElement","cid"]))},{error:"needs a viewName in srcElement",predicate:p.compose(p.is(String),p.path(["data","srcElement","viewName"]))}],A=function(){return[].concat(N).concat(S)};var w=[{error:"need to match a valid name within "+b,predicate:function(e){return f().includes(e.name)}},{error:"needs one of the following step strings: "+v,predicate:function(e){return v.includes(e.STEP)}},{error:"type needs to one of the following: "+E,predicate:function(e){return E.includes(e.type)}},{error:"viewId needs to be added ",predicate:function(e){return void 0!==e.viewId}}];g=function(){return[].concat(w)},T=function(){return[{error:"DISPOSE STEP requires a disposeItem param in the data object",predicate:function(e){return"DISPOSE"===e.STEP&&void 0!==e.data.disposeItems}}].concat(w)},_=function(){var e=[{error:"UPDATE STEP requires a data object ",predicate:function(e){return"UPDATE"===e.STEP&&void 0!==e.data}}];return e.concat(w)},function(){return w.concat(N).concat(S)},function(){return[].concat(N).concat(S)},function(){var e=[{error:"param 'name' must be of a registered type",predicate:function(e){return f().includes(e.name)}},{error:"param 'observable' must contain a valid Rx.Observable",predicate:function(e){return b.includes((0,e.observable)().constructor.name)}},{error:"param action must be a registered action",predicate:function(e){return y.includes(e.action)}}];return{streams:[{init:{name:"DISPATCHER",observable:function(){return new m.Subject},action:"subscribe"},structure:{type:String,observable:m.Observable||m.Subject,action:String},validations:e},{init:{name:"UBU",observable:function(){return new m.Subject},action:"subscribe"},structure:{type:String,observable:m.Observable||m.Subject,action:String},validations:e}]}}}var C=r(0);class O{constructor(e,t,r,n,i){var o=e,a={channel:o,action:t,channelPayload:r,srcElement:n,event:i},s=window.Spyne.getChannelActions(o);return O.validateAction(t,o,s),"ROUTE"===o&&(a.location=O.getLocationData()),a}static validateAction(e,t,r){var n=C.contains(e,r);return!1===n&&void 0!==window.Spyne&&console.warn("warning: Action: '"+e+"' is not registered within the "+t+" channel!"),n}static getLocationData(){return C.pickAll(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getStreamItem(){}static getMouseEventKeys(){return["altKey","bubbles","cancelBubble","cancelable","clientX","clientY","composed","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","isTrusted","layerX","layerY","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","path","relatedTarget","returnValue","screenX","screenY","shiftKey","sourceCapabilities","srcElement","target","timeStamp","toElement","type","view","which","x","y"]}}function D(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function I(e,t){var r;return t&&!0===t.clone&&D(e)?P((r=e,Array.isArray(r)?[]:{}),e,t):e}function R(e,t,r){var n=e.slice();return t.forEach(function(t,i){void 0===n[i]?n[i]=I(t,r):D(t)?n[i]=P(e[i],t,r):-1===e.indexOf(t)&&n.push(I(t,r))}),n}function P(e,t,r){var n=Array.isArray(t),i=(r||{arrayMerge:R}).arrayMerge||R;return n?Array.isArray(e)?i(e,t,r):I(t,r):function(e,t,r){var n={};return D(e)&&Object.keys(e).forEach(function(t){n[t]=I(e[t],r)}),Object.keys(t).forEach(function(i){D(t[i])&&e[i]?n[i]=P(e[i],t[i],r):n[i]=I(t[i],r)}),n}(e,t,r)}P.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce(function(e,r){return P(e,r,t)})};var L=r(1),M=r(0);class V{constructor(e){var t=this;void 0===e&&(e={}),this.addMixins(),this.addRegisteredActions.bind(this),this.createChannelActionsObj();var r=new L.Subject;this.props=P({name:"observer"},e),this.observer$=this.props.observer=r,this.streamsController=window.Spyne.channels,this.streamsController.getStream("DISPATCHER").subscribe(function(e){return t.onIncomingObservable(e)})}initializeStream(){}setTrace(e){}createChannelActionsObj(){var e=this.addRegisteredActions(),t=M.mergeAll(M.chain(function(e){return M.objOf(e,e)},e));this.channelActions=t}addRegisteredActions(){return[]}get observer(){return this.observer$}onIncomingObservable(e){var t=this,r=function(t){return{observableData:e.data,observableEvent:t}};return!0===M.equals(e.name,this.props.name)?function(e){return e.observable.map(r).subscribe(t.onIncomingObserverableData.bind(t))}(e):void 0}onIncomingObserverableData(e){}sendStreamItem(e,t,r,n,i){void 0===i&&(i=this.observer$);var o=new O(this.props.name,e,t,r,n);i.next(Object.freeze(o))}getChannel(e){var t=this;return M.ifElse(function(e){return f().includes(e)},function(e){return t.streamsController.getStream(e).observer},function(e){return console.warn("channel name "+e+" is not within "+f)})(e)}addMixins(){}}var H=r(0);class F{constructor(){this.checkIfObjIsNotEmptyOrNil=F.checkIfObjIsNotEmptyOrNil.bind(this)}static checkIfObjIsNotEmptyOrNil(e){var t=H.compose(H.complement(H.isEmpty),H.head,H.values),r=H.compose(H.complement(H.isNil),H.head,H.values);return H.allPass([t,r])(e)}static checkIfParamValueMatchesRegex(e,t){var r=H.reject(H.equals("keyword")),n=H.compose(r,H.keys),i=H.compose(H.find(function(t){return H.test(new RegExp(t),e)}),n)(t);return H.is(String,i)&&(t=H.assoc(e,H.prop(i,t),t)),t}static getLocationStrByType(e,t){void 0===t&&(t=!1);var r={slash:"pathname",query:"search",hash:"hash"}[!0===t?"hash":e];return H.prop(r,window.location).replace(/^(\/)?(#)?(\/)?(.*)$/,"$4")}static createRouteArrayFromParams(e,t,r,n){var i=this;void 0===r&&(r="slash");var o=[];return function t(r){var a={},s=r.keyword,c=void 0!==e[s]?e[s]:H.prop(s,n),u=typeof r[c];"string"===u?c=r[c]:"undefined"===u&&(r=i.checkIfParamValueMatchesRegex(c,r)),a[s]=c,i.checkIfObjIsNotEmptyOrNil(a)&&o.push(a);var d=H.is(Object,r),h=H.has(c,r),l=H.has("route",r);if(!0===(h&&d)){var p=r[c];H.has("route",p)&&t(p.route)}else!0===l&&void 0!==c&&t(r.route)}(t),o}static createSlashString(e){var t=H.reject(H.isNil),r=H.when(H.complement(H.isNil,H.__),H.join("/"));return H.compose(r,t,H.flatten,H.map(H.values))(e)}static createQueryString(e){var t=H.reject(H.isNil),r=this.checkIfObjIsNotEmptyOrNil,n=H.compose(H.join("="),H.flatten,H.toPairs),i=H.ifElse(r,n,H.always(void 0)),o=H.map(i),a=H.when(H.complement(H.isEmpty),H.concat("?"));return H.compose(a,H.join("&"),t,o)(e)}static convertParamsToRoute(e,t,r,n){void 0===t&&(t=window.Spyne.config.channels.ROUTE);var i=void 0!==r?r:t.type,o=t.isHash,a=t.routes.route,s=void 0!==n?n:this.getLocationStrByType(i,o),c=this.convertRouteToParams(s,t,i).keywords,u=this.createRouteArrayFromParams(e,a,i,c);return"query"===i?this.createQueryString(u):this.createSlashString(u)}static checkIfValueShouldMapToParam(e,t){var r=H.invert(e),n=H.compose(H.is(String),H.head,H.defaultTo([]),H.prop(t)),i=H.compose(H.head,H.prop(t));return H.ifElse(n,i,H.always(t))(r)}static createArrFromSlashStr(e){return e.replace(/^([/])?(.*)$/,"$2").split("/")}static convertSlashRouteStrToParamsObj(e,t){var r=this,n=t,i=this.createArrFromSlashStr(t),o=[],a=[],s=e;H.reduce(function(e,t){var n=r.checkIfValueShouldMapToParam(s,t);void 0!==(s=r.checkIfParamValueMatchesRegex(t,s))&&(o.push(s.keyword),a.push(n));var i=[t,"route"],c=H.path(i,s),u=H.path(["route"],s);void 0!==c?s=c:void 0!==u&&(s=u)},0,i);var c=H.zipObj(o,a),u=this.getLastArrVal(o);return{routeKeywordsArr:o,routeKeyword:u,keywords:c,routeValue:n}}static getLastArrVal(e){var t;return t=e,void 0!==H.last(t)?H.last(t):""}static createDefaultParamFromEmptyStr(e,t){var r={};return r[e.keyword]=this.checkIfValueShouldMapToParam(e,t),r}static convertQueryStrToParams(e,t){var r=t,n=t.replace(/^([?])?(.*)$/,"$2"),i=H.compose(H.map(H.split("=")),H.split("&"))(n),o=H.fromPairs(i),a=H.map(H.head,i);return!0===H.isEmpty(t)&&(o=this.createDefaultParamFromEmptyStr(e,t),a=H.keys(o)),{routeKeywordsArr:a,routeKeyword:this.getLastArrVal(a),keywords:o,routeValue:r}}static convertRouteToParams(e,t,r){if(void 0===t)return{};var n=void 0!==r?r:t.type,i=t.routes.route;return"query"===n?this.convertQueryStrToParams(i,e):this.convertSlashRouteStrToParamsObj(i,e)}}var W=r(0),x=r(1);class U{constructor(){this.createPopStateStream=U.createPopStateStream.bind(this)}static createPopStateStream(e){x.Observable.fromEventPattern(function(e){window.onpopstate=e},function(){window.onpopstate=function(){}}).subscribe(e)}static getLastArrVal(e){var t;return t=e,void 0!==W.last(t)?W.last(t):""}static getRouteArrData(e,t){var r=W.filter(W.contains(W.__,e),t);return{routeKeywordsArr:r,routeKeyword:U.getLastArrVal(r)}}static flattenConfigObject(e){return W.values(W.fromPairs(function e(t){return W.chain(function(t){var r=t[0],n=t[1];return"[object Object]"===Object.prototype.toString.call(n)?W.map(function(e){var t=e[0],n=e[1];return[r+"."+t,n]},e(n)):[[r,n]]},W.toPairs(t))}(e)))}static getLocationData(){return W.pickAll(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}}var j=r(1),$=r(0);class k extends V{constructor(){var e;e=super(),this.createChannelActionsObj(),this.props.name="ROUTE",this.routeConfigJson=this.getRouteConfig(),this.bindStaticMethods(),this.navToStream$=new j.BehaviorSubject,this.observer$=this.navToStream$.map(function(t){return e.onMapNext(t)})}initializeStream(){this.initStream()}createChannelActionsObj(){var e=this.addRegisteredActions(),t=$.mergeAll($.chain(function(e){return $.objOf(e,e)},e));this.channelActions=t}addRegisteredActions(){return["CHANNEL_ROUTE_DEEPLINK_EVENT","CHANNEL_ROUTE_CHANGE_EVENT"]}getRouteConfig(){var e=window.Spyne.config,t=$.path(["channels","ROUTE"],e);"query"===t.type&&(t.isHash=!1);var r=U.flattenConfigObject(t.routes);return t.paramsArr=r,t}initStream(){this.firstLoadStream$=new j.BehaviorSubject(this.onIncomingDomEvent(void 0,this.routeConfigJson,"CHANNEL_ROUTE_DEEPLINK_EVENT")),U.createPopStateStream(this.onIncomingDomEvent.bind(this)),this.observer$=j.Observable.merge(this.firstLoadStream$,this.navToStream$)}onMapNext(e,t){return void 0===t&&(t=!1),e.action="CHANNEL_ROUTE_CHANGE_EVENT",e}static onIncomingDomEvent(e,t,r){void 0===t&&(t=this.routeConfigJson);var n=void 0!==r?r:this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,i=this.getDataFromString(t);this.sendStreamItem(n,i,void 0,void 0,this.navToStream$)}onIncomingObserverableData(e){var t=this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,r=this.getDataFromParams(e),n=$.path(["observableData","srcElement"],e),i=e.observableEvent,o=!r.isHidden;this.sendRouteStream(r,o),this.sendStreamItem(t,r,n,i,this.navToStream$)}sendRouteStream(e,t){void 0===t&&(t=!0),!0===t&&this.setWindowLocation(e)}static getRouteState(e){return"CHANNEL_ROUTE_CHANGE_EVENT"}static getIsDeepLinkBool(){return 0===this._routeCount}static getRouteCount(){return void 0===this._routeCount?(this._routeCount=0,this._routeCount):(this._routeCount+=1,this._routeCount)}static getExtraPayloadParams(e){return void 0===e&&(e=this.routeConfigJson),{routeCount:this.getRouteCount(),isDeepLink:this.getIsDeepLinkBool(),isHash:e.isHash,isHidden:e.isHidden,routeType:e.type}}static getDataFromParams(e,t){void 0===t&&(t=this.routeConfigJson);var r=$.path(["observableData","payload"],e),n=this.getRouteStrFromParams(r,t),i=this.getDataFromLocationStr(),o=i.routeKeyword,a=i.routeKeywordsArr;r=$.merge(i.keywords,r);var s=this.getExtraPayloadParams(t),c=s.routeCount;return{isDeepLink:s.isDeepLink,routeCount:c,routeKeyword:o,routeKeywordsArr:a,keywords:r,routeValue:n,isHash:s.isHash,isHidden:s.isHidden,routeType:s.routeType}}static getDataFromString(e,t){void 0===e&&(e=this.routeConfigJson);var r=e.type,n=!0===e.isHash,i=F.getLocationStrByType(r,n),o=k.getParamsFromRouteStr(i,e,r),a=o.routeKeywordsArr,s=o.routeKeyword,c=o.keywords,u=o.routeValue,d=this.getExtraPayloadParams(e),h=d.routeCount,l=d.isDeepLink,p=d.isHash,m=d.routeType;return{isDeepLink:l,routeCount:h,routeKeyword:s,routeKeywordsArr:a,keywords:c,routeValue:u,isHash:p,isHidden:d.isHidden,routeType:m}}static getDataFromLocationStr(e){void 0===e&&(e="slash");var t=void 0!==this.routeConfigJson?this.routeConfigJson.type:e,r=F.getLocationStrByType(t),n=this.getParamsFromRouteStr(r,this.routeConfigJson,t);return{routeKeywordsArr:n.routeKeywordsArr,routeKeyword:n.routeKeyword,keywords:n.keywords,routeValue:n.routeValue,action:this.getRouteState()}}static getLocationData(){return $.pickAll(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getRouteStrFromParams(e,t,r){var n=void 0!==r?r:t.type;return F.convertParamsToRoute(e,t,n)}static getParamsFromRouteStr(e,t,r){var n=void 0!==r?r:t.type;return F.convertRouteToParams(e,t,n)}checkEmptyRouteStr(e,t){void 0===t&&(t=!1);var r=$.isEmpty(e),n=!0===r&&!1===t,i=!0===r&&!0===t,o=!1===r&&!0===t;return console.log("ROUTE STR CHECK ",{str:e,isHash:t}),!0===n||!0===i?"/":!0===o?$.concat("#",e):e}setWindowLocation(e){var t=e.isHash,r=e.routeValue;if(r=this.checkEmptyRouteStr(r,t),!0===t)console.log("ROUTE STR FOR HASH ",r),window.history.pushState({},"",r);else{var n=$.when($.compose($.complement($.equals("/")),$.head),$.concat("/",$.__));window.history.pushState({},"",n(r))}}getWindowLocation(){return window.location.pathname}bindStaticMethods(){this.getIsDeepLinkBool=k.getIsDeepLinkBool.bind(this),this.getDataFromLocationStr=k.getDataFromLocationStr.bind(this),this.onIncomingDomEvent=k.onIncomingDomEvent.bind(this),this.getDataFromString=k.getDataFromString.bind(this),this.getParamsFromRouteStr=k.getParamsFromRouteStr.bind(this),this.getLocationData=k.getLocationData.bind(this),this.getRouteState=k.getRouteState.bind(this),this.getDataFromParams=k.getDataFromParams.bind(this),this.getRouteCount=k.getRouteCount.bind(this),this.getExtraPayloadParams=k.getExtraPayloadParams.bind(this);var e=$.curryN(3,k.getRouteStrFromParams);this.getRouteStrFromParams=e($.__,this.routeConfigJson,this.routeConfigJson.type)}}var B=r(0),G=r(1);class q extends V{constructor(){super(),this.props.name="UI",this.keyEventsLoaded=!1,this.keyCodeArr=[]}addRegisteredActions(){return["CHANNEL_UI_EVENT","CHANNEL_UI_BLUR_EVENT","CHANNEL_UI_CLICK_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_DBLCLICK_EVENT","CHANNEL_UI_FOCUS_EVENT","CHANNEL_UI_FOCUSIN_EVENT","CHANNEL_UI_FOCUSOUT_EVENT","CHANNEL_UI_INPUT_EVENT","CHANNEL_UI_KEYDOWN_EVENT","CHANNEL_UI_KEYPRESS_EVENT","CHANNEL_UI_KEYUP_EVENT","CHANNEL_UI_MOUSEDOWN_EVENT","CHANNEL_UI_MOUSEENTER_EVENT","CHANNEL_UI_MOUSELEAVE_EVENT","CHANNEL_UI_MOUSEMOVE_EVENT","CHANNEL_UI_MOUSEOUT_EVENT","CHANNEL_UI_MOUSEOVER_EVENT","CHANNEL_UI_MOUSEUP_EVENT","CHANNEL_UI_SELECT_EVENT"]}loadKeyStream(){var e=this,t=G.Observable.fromEvent(document,"keyup");this.keyPresses$=t.groupBy(function(e){return e.keyCode}).mergeAll().filter(function(t){return e.keyCodeArr.indexOf(t.keyCode)>=0}).repeat().subscribe(this.onKeyPressed.bind(this))}addKeyEvent(e){!1===this.keyEventsLoaded&&this.loadKeyStream(),this.keyEventsLoaded=!0,this.registerKey(e)}registerKey(e){this.keyCodeArr.push(e)}onKeyPressed(e){console.log("key is ",e)}onIncomingObservable(e){var t=this,r=function(t){return{observableData:e.data,uiEvent:t}};return!0===B.equals(e.name,this.props.name)?function(e){return e.observable.map(r).subscribe(t.onUIEvent.bind(t))}(e):void 0}getActionState(e){var t=B.path(["uiEvent","type"]),r=B.path(["uiEvent","typeOverRide"]),n=B.compose(B.toUpper,B.either(r,t))(e);return void 0!==n?"CHANNEL_UI_"+n+"_EVENT":"CHANNEL_UI"}onUIEvent(e){e.action=this.getActionState(e);var t=e.action,r=e.observableData,n=r.payload,i=r.srcElement,o=e.uiEvent;this.sendStreamItem(t,n,i,o)}}var K=r(1),Y=r(0);class Q{constructor(){this.createDomObservableFromEvent=Q.createDomObservableFromEvent.bind(this)}static createDomObservableFromEvent(e,t,r){void 0===r&&(r=!0);return t=void 0===t?function(e){return e}:t,K.Observable.fromEventPattern(function(t){return window.addEventListener(e,t,{passive:r})},function(){window[e]=function(e){return e}}).map(t)}static createMediaQuery(e){var t=window.matchMedia(e);return this.checkIfValidMediaQuery(t,e),t}static checkIfValidMediaQuery(e,t){var r=function(e){return e.replace(/\s+/gm,"")},n="MediaQueryList"===e.constructor.name&&r(e.media)===r(t);return!1===n&&function(t){console.warn('Spyne Warning: the following query string, "'+t+'", does not match "'+e.media+'" and may not be a valid Media Query item!')}(t),n}static createMediaQueryHandler(e,t){var r,n=function(e){return function(t){return t.mediaQueryName=e,t}}(t),i=(r=e,{addHandler:function(e){r.onchange=e},removeHandler:function(e){r.onchange=function(){}}});return new K.Observable.fromEventPattern(i.addHandler,i.removeHandler).map(n)}static createMergedObsFromObj(e){var t=e.mediqQueries,r=[];return Y.mapObjIndexed(function(e,t,n){var i=Q.createMediaQuery(e);r.push(Q.createMediaQueryHandler(i,t))},t),r}}var z=r(0),J=r(1);class X extends V{constructor(){super(),this.bindStaticMethods(),this.observer$=new J.Subject,this.props.name="WINDOW"}initializeStream(){var e,t=this;this.domChannelConfig=window.Spyne.config.channels.WINDOW,this.currentScrollY=window.scrollY;var r=this.getActiveObservables();(e=J.Observable).merge.apply(e,r).subscribe(function(e){var r=e.action,n=e.channelPayload,i=e.srcElement,o=e.event;t.sendStreamItem(r,n,i,o)})}static getScrollMapFn(e){var t=this.channelActions.CHANNEL_WINDOW_SCROLL_EVENT,r=window.scrollY,n=this.currentScrollY-r,i=n>=0?"up":"down";return this.currentScrollY=r,{action:t,channelPayload:{scrollY:r,scrollDistance:n,scrollDir:i},srcElement:e.srcElement,scrollDistance:n,event:e}}static getMouseWheelMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_MOUSEWHEEL_EVENT,channelPayload:{scrollDir:e.deltaY<=0?"up":"down",deltaX:e.deltaX,deltaY:e.deltaY,deltaZ:e.deltaZ},srcElement:e.srcElement,event:e}}static createCurriedGenericEvent(e){var t="CHANNEL_WINDOW_"+e.toUpperCase()+"_EVENT";return z.curry(X.mapGenericEvent)(t)}static mapGenericEvent(e,t){return console.log("map generic event ",e),{action:e,channelPayload:t,srcElement:t.srcElement,event:t}}static getResizeMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_RESIZE_EVENT,channelPayload:z.pick(["innerWidth","innerHeight","outerWidth","outerHeight"],window),srcElement:e.srcElement,event:e}}static getOrientationMapFn(e){var t=this.channelActions.CHANNEL_WINDOW_ORIENTATION_EVENT,r=window.matchMedia("(orientation: portrait)").matches,n=z.pick(["innerWidth","innerHeight","outerWidth","outerHeight"],window);return n.orientation=!0===r?"portrait":"landscape",{action:t,channelPayload:n,srcElement:e.srcElement,event:e}}getMediaQueryMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_MEDIA_QUERY_EVENT,channelPayload:z.pick(["matches","media","mediaQueryName"],e),srcElement:e.srcElement,event:e}}createMouseWheelObservable(e){var t=e.debounceMSTimeForScroll;return Q.createDomObservableFromEvent("mousewheel",X.getMouseWheelMapFn.bind(this)).debounceTime(t)}createScrollObservable(e){var t=e.debounceMSTimeForScroll;return Q.createDomObservableFromEvent("scroll",X.getScrollMapFn.bind(this)).debounceTime(t).skipWhile(function(e){return 0===e.scrollDistance})}createOrientationObservable(e){return Q.createDomObservableFromEvent("orientationchange",X.getOrientationMapFn.bind(this))}createResizeObservable(e){var t=e.debounceMSTimeForResize;return Q.createDomObservableFromEvent("resize",X.getResizeMapFn.bind(this)).debounceTime(t)}getEventsFromConfig(e){void 0===e&&(e=this.domChannelConfig);var t=e.events;return z.map(function(e){var t=X.createCurriedGenericEvent(e);return Q.createDomObservableFromEvent(e,t)},t)}getActiveObservables(e){void 0===e&&(e=this.domChannelConfig);var t=[];e.listenForMediaQueries=d(e.mediqQueries);var r={listenForResize:this.createResizeObservable.bind(this),listenForOrientation:this.createOrientationObservable.bind(this),listenForScroll:this.createScrollObservable.bind(this),listenForMouseWheel:this.createMouseWheelObservable.bind(this)};z.mapObjIndexed(function(r,n,i){e[n]&&t.push(r(e))},r),this.checkForMediaQueries(e.listenForMediaQueries);var n=this.getEventsFromConfig(e);return t=t.concat(n)}checkForMediaQueries(e){var t=this;!0===e&&this.getMediaQueryObservable(this.domChannelConfig).subscribe(function(e){var r=e.action,n=e.channelPayload,i=e.srcElement,o=e.event;t.sendStreamItem(r,n,i,o,t.observer$)})}getMediaQueryObservable(e){var t,r=this.createMergedObsFromObj(e);return(t=J.Observable).merge.apply(t,r).map(this.getMediaQueryMapFn.bind(this))}addRegisteredActions(){return["CHANNEL_WINDOW_SCROLL_EVENT","CHANNEL_WINDOW_MOUSEWHEEL_EVENT","CHANNEL_WINDOW_MEDIA_QUERY_EVENT","CHANNEL_WINDOW_RESIZE_EVENT","CHANNEL_WINDOW_ORIENTATION_EVENT","CHANNEL_WINDOW_CACHED_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_ABORT_EVENT","CHANNEL_WINDOW_LOAD_EVENT","CHANNEL_WINDOW_BEFOREUNLOAD_EVENT","CHANNEL_WINDOW_UNLOAD_EVENT","CHANNEL_WINDOW_ONLINE_EVENT","CHANNEL_WINDOW_OFFLINE_EVENT","CHANNEL_WINDOW_FOCUS_EVENT","CHANNEL_WINDOW_BLUR_EVENT","CHANNEL_WINDOW_OPEN_EVENT","CHANNEL_WINDOW_MESSAGE_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_CLOSE_EVENT","CHANNEL_WINDOW_PAGEHIDE_EVENT","CHANNEL_WINDOW_PAGESHOW_EVENT","CHANNEL_WINDOW_POPSTATE_EVENT","CHANNEL_WINDOW_ANIMATIONSTART_EVENT","CHANNEL_WINDOW_ANIMATIONEND_EVENT","CHANNEL_WINDOW_ANIMATIONITERATION_EVENT","CHANNEL_WINDOW_TRANSITIONSTART_EVENT","CHANNEL_WINDOW_TRANSITIONCANCEL_EVENT","CHANNEL_WINDOW_TRANSITIONEND_EVENT","CHANNEL_WINDOW_TRANSITIONRUN_EVENT","CHANNEL_WINDOW_RESET_EVENT","CHANNEL_WINDOW_SUBMIT_EVENT","CHANNEL_WINDOW_BEFOREPRINT_EVENT","CHANNEL_WINDOW_AFTERPRINT_EVENT","CHANNEL_WINDOW_COMPOSITIONSTART_EVENT","CHANNEL_WINDOW_COMPOSITIONUPDATE_EVENT","CHANNEL_WINDOW_COMPOSITIONEND_EVENT","CHANNEL_WINDOW_FULLSCREENCHANGE_EVENT","CHANNEL_WINDOW_FULLSCREENERROR_EVENT","CHANNEL_WINDOW_CUT_EVENT","CHANNEL_WINDOW_COPY_EVENT"]}bindStaticMethods(){this.createMediaQueryHandler=Q.createMediaQueryHandler.bind(this),this.createMergedObsFromObj=Q.createMergedObsFromObj.bind(this)}}var Z=r(2),ee=r.n(Z),te=r(0),re=ee.a.Success,ne=ee.a.Failure,ie=function(){};void 0!==te&&(ie=te.curry(function(e,t){var r=re(te.curryN(te.length(e),te.always(t)));return te.reduce(function(e,r){return e.ap(r.predicate(t)?re(t):ne([r.error]))},r,e)}));var oe=r(1);class ae{constructor(e){this.addMixins(),this.map=new Map,this.map.set("DISPATCHER",new oe.Subject)}init(){this.createMainStreams()}createObserver(e){ie(e.validations,e.init),this.map.set(e.init.name,e.init.observable())}createMainStreams(){this.routeValueeam=new k,this.map.set("ROUTE",this.routeValueeam),this.uiStream=new q,this.map.set("UI",this.uiStream),this.domStream=new X,this.map.set("WINDOW",this.domStream),this.routeValueeam.initializeStream(),this.domStream.initializeStream()}addKeyEvent(e){this.map.get("UI").addKeyEvent(e)}registerStream(e,t){this.map.set(e,t),t.initializeStream()}getChannelActions(e){return this.map.get(e).addRegisteredActions()}getStream(e){if(void 0!==this.map.get(e))return this.map.get(e);console.warn('Spyne Warning: The Channel named "'+e+'" does not appear to be registered!')}addMixins(){}}function se(){return{createpropsMap:function(){var e=new WeakMap,t={cid:this.props.cid};return e.set(t,this.props),{key:t,weakMap:e}},gc:function(){for(var e in this)delete this[e]},createId:function(){return"cid-"+Math.floor(1e7*Math.random(1e7))},setTraceFunc:function(e){return!0===e?console.log:function(){}}}}var ce=r(0);class ue{constructor(e,t){var r=this;this.template=this.formatTemplate(e),this.templateData=t;var n=ue.getStringArray(this.template),i=this.template.match(ue.findTmplLoopsRE());i=null===i?[]:i;var o=ce.contains(ce.__,i),a=ce.ifElse(o,function(e,t){return e.replace(ue.parseTmplLoopsRE(),r.parseTheTmplLoop.bind(r))},this.addParams.bind(this));this.finalArr=n.map(a)}static getStringArray(e){var t=e.split(ue.findTmplLoopsRE()),r=/^([\\n\s\W]+)$/;return ce.reject(function(e){return e.match(r)},t)}static findTmplLoopsRE(){return/({{#\w+}}[\w\n\s\W]+?{{\/\w+}})/gm}static parseTmplLoopsRE(){return/({{#(\w+)}})([\w\n\s\W]+?)({{\/\2}})/gm}static swapParamsForTagsRE(){return/({{)(.*?)(}})/gm}removeThis(){this.finalArr=void 0,this.templateData=void 0,this.template=void 0}getTemplateNode(){var e=this.finalArr.join(" "),t=document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),10),t}getTemplateString(){return this.finalArr.join(" ")}formatTemplate(e){return"string"==typeof e?e:e.text}addParams(e){var t=this;return e.replace(ue.swapParamsForTagsRE(),function(e,r,n,i){var o=t.templateData[n];return ce.defaultTo("")(o)})}parseTheTmplLoop(e,t,r,n){var i=n;return this.templateData[r].map(function(e){var t;return"string"==typeof e?(t=e,e=i.replace(ue.swapParamsForTagsRE(),t)):e=function(e,t){return t.replace(ue.swapParamsForTagsRE(),function(t,r,n){return e[n]})}(e,i),e}).join(" ")}}var de=r(0);class he{constructor(e,t,r,n){void 0===e&&(e="div"),void 0===t&&(t={}),void 0===r&&(r=void 0),void 0===n&&(n=void 0),!0===de.is(String,t)&&(r=t,t={}),this.props=new Map,this.setProp("fragment",document.createDocumentFragment()),this.setProp("tagName",e),this.setProp("attrs",this.updateAttrs(t)),this.setProp("content",r),this.setProp("template",n),this.addMixins()}setProp(e,t){this.props.set(e,t)}getProp(e){return this.props.get(e)}get el(){return this.props.get("el")}setElAttrs(e,t){return this.getProp("attrs").forEach(function(t,r){"dataset"===r?de.forEachObjIndexed(function(t,r){e.dataset[r]=t},t):e.setAttribute(r,t)}),e}updateAttrs(e,t){var r=void 0!==t?t:new Map;return de.mapObjIndexed(function(e,t){return r.set(t,e)},e),r}addTemplate(e){var t=this,r=this.getProp("template");return void 0!==r?function(r){var n=t.getProp("content");n=de.is(Object,n)?n:{};var i=new ue(r,n).getTemplateNode();return e.appendChild(i),e}(r):function(e){return e}(e)}createElement(e){return void 0===e&&(e="div"),document.createElement(e)}addContent(e){var t=this.getProp("content");if(!0===de.is(String,t)){var r=document.createTextNode(t);e.appendChild(r)}return e}execute(){var e=de.pipe(this.createElement.bind(this),this.setElAttrs.bind(this),this.addTemplate.bind(this),this.addContent.bind(this))(this.getProp("tagName"));this.props.set("el",e)}render(){return this.execute(),this.getProp("el")}returnIfDefined(e,t){if(void 0!==t){var r=void 0===t;e[t]=!1===r?t:P(e[va],t)}}updateprops(e){return this.returnIfDefined(this.props,e),this}updatepropsAndRun(e){return this.updateprops(e),this.execute(),this.getProp("fragment")}unmount(){void 0!==this.props&&(this.getProp("el").remove(),this.props.clear(),this.gc())}updateTag(e){void 0===e&&(e="div"),this.updateprops(e)}updateAttributes(e){void 0===e&&(e={}),this.updateprops(e)}updateTemplate(e){this.updateprops(e)}updateData(e){void 0===e&&(e={}),this.updateprops(e)}addTagAndRender(e){void 0===e&&(e="div"),this.updatepropsAndRun(e)}addAttrsibutesAndRender(e){void 0===e&&(e={}),this.updatepropsAndRun(e)}addTemplateAndRender(e){this.updatepropsAndRun(e)}addDataAndRender(e){void 0===e&&(e={}),this.updatepropsAndRun(e)}addMixins(){var e=se();this.gc=e.gc.bind(this)}}var le=function(e,t,r,n){return void 0===e&&(e=!1),void 0===t&&(t=1),void 0===r&&(r="ease"),void 0===n&&(n=!1),(!0===n?"opacity:0;":"")+"transition: opacity "+t+"s "+r+"; opacity: "+(!0===e?1:0)+";"};var pe=r(1),me=r(0);class fe{constructor(e){this.props.observableStreams=fe.createDirectionalObservables()}static createDirectionalFiltersObject(){return{P:["parent"],C:["child"],PCI:["parent","internal","child"],CI:["child","internal"],PI:["parent","internal"],PC:["parent","child"]}}static addDefaultDir(e){return me.flip(me.merge)({$dir:["internal"]},me.clone(e))}static addDownInternalDir(e,t){return void 0===t&&(t=["internal","down"]),me.flip(me.merge)(me.clone(e),{$dir:t})}static addChildAndInternalDir(e,t){return void 0===t&&(t=["child","down"]),me.flip(me.merge)(me.clone(e),{$dir:t})}static mapToDefaultDir(e){return this.addDefaultDir(e)}static createDirectionalObservables(e,t,r){void 0===e&&(e=new pe.Subject),void 0!==t&&void 0!==r&&(e.viewName=t,e.cid=r);var n=function(e){return me.propSatisfies(function(t){return t.includes(e)},"$dir")},i=n("parent"),o=n("child"),a=n("internal"),s=function(e){return me.merge({from$:e})},c=s("child"),u=s("internal"),d=s("parent"),h=e.filter(function(e){return void 0!==e&&void 0!==e.action}),l=e.filter(a).map(u),p=e.filter(i).map(c),m=e.filter(o).map(d),f={parent:p,internal:l,child:m};return{raw$:h,toInternal$:l,toParent$:p,toChild$:m,completeAll:function(){me.forEach(function(e){e.complete(),e.isStopped=!0},[h,l,p,m])},completeStream:function(e){void 0===e&&(e=[]);void 0!==e&&e.length>=1&&e.forEach(function(e){var t;void 0!==f[e]&&((t=f[e]).complete(),t.isStopped=!0)})}}}}var ve=r(1),Ee=r(0);class be{constructor(e,t,r,n){var i=this;void 0===t&&(t={}),void 0===r&&(r=""),void 0===n&&(n="theName"),this.addMixins(),this._state="INIT",this.cid=r,this.vsName=n,this.defaults={debug:!1,extendedHashMethods:{}},this.options=P(this.defaults,t);this.addActionListeners().forEach(function(e){var t=e[0],r=e[1];i.options.extendedHashMethods[t]=function(e){return i[r](e)}}),this.options.hashMethods=this.setHashMethods(this.options.extendedHashMethods),this.sink$=e,this.sink$.subscribe(this.onSinkSubscribe.bind(this)),this.$dirs=fe.createDirectionalFiltersObject(),this.addDefaultDir=fe.addDefaultDir,this.sourceStreams=fe.createDirectionalObservables(new ve.Subject,this.vsName,this.cid),this._source$=this.sourceStreams.toInternal$}addActionListeners(){return[]}setHashMethods(e){var t=this;return void 0===e&&(e={}),P({GARBAGE_COLLECT:function(e){return t.onGarbageCollect(e)},READY_FOR_GC:function(e){return t.onReadyForGC(e)},DISPOSE:function(e){return t.onDispose(e)},RENDER:function(e){return t.onRender(e)},RENDER_AND_ATTACH_TO_PARENT:function(e){return t.onRenderAndAttachToParent(e)},RENDER_AND_ATTACH_TO_DOM:function(e){return t.onRenderAndAttachToDom(e)},ATTACH_CHILD_TO_SELF:function(e){return t.onAttachChildToSelf(e)}},e)}createDomItem(){this.props=void 0!==this.props?this.props:{};var e=Ee.filter(function(e){return void 0!==e},Ee.pick(["id","className"],this.props));return new he(this.props.tagName,e,this.props.data,this.props.template)}onDisposeCompleted(e){}animateInTween(e,t){!function(e,t){var r=1*window.getComputedStyle(e).opacity,n=le(!0,t,"ease",1===r);e.style.cssText+=n}(e,t)}animateOutTween(e,t,r){!function(e,t,r){var n=le(!1,t,"ease");e.style.cssText+=n,console.log(t," inline is ",n),e.addEventListener("transitionend",r,!1)}(e,t,r)}setAnimateIn(e){if(!0===e.animateIn){var t=void 0!==e.el?e.el:this.domItem.el;this.animateInTween(t,e.animateOutTime)}}disposeMethodOld(e){var t=this,r=ve.Observable.bindCallback(function(e,r){var n=void 0!==e.el.el?e.el.el:e.el;t.animateOutTween(n,e.animateOutTime,r)}),n=function(e){t._source$.next({action:"READY_FOR_GC",$dir:t.$dirs.I})};return(!0===e.animateOut?function(e){return r(e).subscribe(n),{action:"DISPOSING",$dir:t.$dirs.CI}}:function(){return{action:"DISPOSE_AND_READY_FOR_GC",$dir:t.$dirs.PCI}})(e)}disposeMethod(e){var t=this;return void 0!==e.animateOutClass?(function(){var r=void 0!==e.el.el?e.el.el:e.el,n={action:"READY_FOR_GC",$dir:t.$dirs.PI,el:r};e.el$.setClass(e.animateOutClass);ve.Observable.fromEvent(r,"transitionend").filter(function(e){return e.target===r}).take(1).subscribe(function(){t._source$.next(n)})}(),{action:"DISPOSING",$dir:this.$dirs.CI}):{action:"DISPOSE_AND_READY_FOR_GC",$dir:t.$dirs.CI}}onDispose(e){return this.disposeMethod(e)}removeStream(){void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["internal","child"])}onGarbageCollect9(e){var t="PageChildBox"===this.vsName?1e3:0;window.setTimeout(this.onGarbageCollectRun.bind(this),t)}onReadyForGC(e){this.removeStream()}onGarbageCollect(e){this.domItem.unmount(),void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["parent"])}getSourceStream(){return this._source$}combineDomItems(e){var t=Ee.isNil(e.query)?e.node:e.query;("appendChild"===e.attachType?function(e,t){return e.appendChild(t)}:function(e,t){return e.insertBefore(t,e.firstChild)})(t,this.domItem.render()),this.setAnimateIn(e)}onAttachChildToSelf(e){var t=e.childRenderData;return this.combineDomItems(t),{action:"CHILD_ATTACHED",$dir:this.$dirs.PI}}onRenderAndAttachToParent(e){return this.onRender(e),this.combineDomItems(e),{action:"RENDERED_AND_ATTACHED_TO_PARENT",el:this.domItem.el,$dir:this.$dirs.PI}}renderDomItem(e){return this.domItem=new(Function.prototype.bind.apply(he,[null].concat(e))),this.domItem}onRender(e){var t,r=this;return{action:"RENDERED",el:(t=Ee.props(["tagName","domAttributes","data","template"],e),r.renderDomItem(t)),$dir:this.$dirs.I}}extendedMethods(e){}onRenderAndAttachToDom(e){var t,r=this;return e.attachData.el=(t=Ee.props(["tagName","domAttributes","data","template"],e),r.renderDomItem(t)),this.combineDomItems(e.attachData),{action:"RENDERED_AND_ATTACHED_TO_DOM",el:e.attachData.el.el,$dir:this.$dirs.CI}}onSinkSubscribe(e){var t,r=this,n=e.action,i=Ee.defaultTo(function(e){return r.extendedMethods(e)})(this.options.hashMethods[n])(e);void 0!==i&&(t=Object.freeze(i),r._source$.next(t))}addMixins(){var e=se();this.createId=e.createId,this.createpropsMap=e.createpropsMap,this.convertDomStringMapToObj=a,this.ifNilThenUpdate=c}}var ye=r(0);function Ne(){var e=this;setTimeout(function(){ye.forEach(function(e){},e)},1)}r(0);class Se{constructor(e,t,r,n,i){void 0===n&&(n="subscribe"),void 0===i&&(i=!1),this.addMixins(),this.options={name:e,observable:t,data:r,action:n},this.getValidationChecks(e)}getValidationChecks(e){var t,r,n=this,i=window.Spyne.channels.map;return!0===i.has(e)?(r=A,n.onRunValidations(r)):(t="payload Needs a Valid Stream Name!",console.warn(t))}onRunValidations(e){ie(e(),this.options).fold(this.onError.bind(this),this.onSuccess.bind(this))}onPayloadValidated(e){this.sendToDirectorStream(e)}sendToDirectorStream(e){window.Spyne.channels.getStream("DISPATCHER").next(e),this.gc()}onError(e){console.warn("payload failed due to:\n"+e.map(function(e){return"* "+e}).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=Ne}}class Ae{constructor(e,t,r,n,i,o){void 0===i&&(i={}),void 0===o&&(o=!0),this.addMixins(),this.options={name:e,STEP:t,type:r,viewId:n,data:i},this.getValidationChecks(t)}get data(){return this._data}getValidationChecks(e){var t=this;return h({LOAD:g,RENDER:g,MOUNT:g,DISPOSE:T,UNMOUNT:g,GARBAGE_COLLECT:g,UPDATE:_},e,"lifestream payload Needs a Valid Stream Name!").fold(function(e){return console.warn(e)},function(e){return t.onRunValidations(e)})}onRunValidations(e){ie(e(),this.options).fold(this.onError.bind(this),this.onSuccess.bind(this))}onPayloadValidated(e){return this._data=e,e}onError(e){console.error("payload failed due to:\n"+e.map(function(e){return"* "+e}).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=Ne}}var ge=r(0),Te=r(1);function _e(){return{testFunc:function(e){console.log("stream mixin is ",e)},sendRoutePayload:function(e,t){return new Se("ROUTE",e,t,"subscribe")},sendUIPayload:function(e,t){return new Se("UI",e,t,"subscribe")},sendChannelPayload:function(e,t){var r=this,n=function(e){return ge.prop(e,r.props)},i={payload:t,channel:e,srcElement:{cid:n("cid"),el:n("el"),viewName:n("name")}};return new Se(e,new Te.Observable.of(""),i,"subscribe")},sendLifeStreamPayload:function(e,t){return new Se("LIFESTREAM",e,t,"subscribe")},createLifeStreamPayload:function(e,t,r){void 0===t&&(t={}),void 0===r&&(r="parent");var n=this.props.name+": "+this.props.cid;return new Ae("LIFESTREAM",e,r,n,t).data}}}var we=r(0);class Ce{constructor(e,t){this.context=e,this.enhancersMap=new Map,this.enhancersArr=t,this.initMap(),this.addAllEnhancerMethods()}initMap(){this.enhancersMap.set("ALL",[]);var e=l(this.context).allMethods;this.updateMap("LOCAL",e)}getEnhancersMap(){return this.enhancersMap}updateMap(e,t){var r=we.concat(this.enhancersMap.get("ALL"),t);this.enhancersMap.set(e,t),this.enhancersMap.set("ALL",r)}getMethodsArr(e){return this.enhancersMap.get(e)}createEnhancerMethodsObj(e){var t,r,n,i=this,o=function(e){return console.error('Spyne Error: The following enhancer method, "'+e+'", already exists and cannot be added to the '+a.name+" Enhancer!")},a=new e(this.context),s=a.getEnhancerMethods(),c=(t=s.allMethods,r=we.contains(we.__,i.getMethodsArr("ALL")),(n=we.filter(r,t)).forEach(o),n),u=we.dropWhile(we.contains(we.__,c));return s=we.map(u,s),this.updateMap(a.name,s.allMethods),s.enhancer=a,s.name=a.name,s}addAllEnhancerMethods(){var e=this;we.forEach(function(t){var r=e.createEnhancerMethodsObj(t);r.enhancer.bindParentViewStream(r,e.context)},this.enhancersArr)}}var Oe=r(1),De=r(0);class Ie{constructor(e,t){this.addMixins(),this.props=e,this.broadcastFn=t,this.broadcaster(this.broadcastFn)}addDblClickEvt(e){var t=Oe.Observable.fromEvent(e,"click");return t.buffer(t.debounceTime(250)).filter(function(e){return 2===e.length}).map(function(e){var t=De.clone(e[0]);return t.typeOverRide="dblclick",t})}broadcast(e){var t,r=this,n={UI:this.sendUIPayload,ROUTE:this.sendRoutePayload},i=e[0],o=e[1],s=e[2],c=this.props.el.querySelectorAll(i),u=void 0!==s;void 0===c||c.length<=0?console.warn("Spyne Warning: The item "+i+", does not appear to exist!"):(c.forEach=Array.prototype.forEach,c.forEach(function(e){var i="dblClick"!==o?Oe.Observable.fromEvent(e,o):r.addDblClickEvt(e);t=e.dataset.channel;var s={};s.payload=a(e.dataset),s.payload=De.omit(["channel"],s.payload),s.channel=t,s.srcElement={},s.srcElement.cid=r.props.id,s.srcElement.isLocalEvent=u,s.srcElement.viewName=r.props.name,s.srcElement.event=o,s.srcElement.el=e,(void 0!==t?n[t]:n.UI)(i,s)}))}broadcaster(e){var t=this;e().forEach(function(e){return t.broadcast(e)})}addMixins(){var e=_e();this.sendUIPayload=e.sendUIPayload,this.sendRoutePayload=e.sendRoutePayload,this.createLifeStreamPayload=e.createLifeStreamPayload}}var Re=r(0);class Pe{constructor(e,t){this.el=void 0!==t?e.querySelectorAll(t):e,this.queryStr=t,1===this.el.length?this.el=Re.head(this.el):"NodeList"===this.el.constructor.name&&(this.el=Pe.createArrayFromNodeList(this.el)),this.cList=this.el.classList,this.elProps=new Map,this.createMethods()}static createArrayFromNodeList(e){return Re.reduce(function(e,t){return e.push(t),e},[],e)}createMethods(){this.addClass=this.mapToValue(function(e,t){return e.classList.add(t)}),this.removeClass=this.mapToValue(function(e,t){return e.classList.remove(t)}),this.setClass=this.mapToValue(function(e,t){return e.classList.value=t,e}),this.inlineCss=this.mapToValue(function(e,t){return e.style.cssText=t,e}),this.toggleClass=this.mapToValue(function(e,t,r){return void 0===r&&(r=!0),e.classList.toggle(t,r),e})}mapMethod(e){var t=this;return function(r){return t.elArr.map(e),t}}addAnimClass(e){var t=this,r=function(){return t.addClass(e)};return requestAnimationFrame(function(){setTimeout(r,0)}),this}mapToValue(e){var t=this;return function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.elArr.map(function(t){return e.apply(void 0,[t,r].concat(i))}),t}}setClassOnBool(e,t){return void 0===e&&(e=""),void 0===t&&(t=!0),t?this.addClass(e):this.removeClass(e),this}setActiveItem(e,t){var r=document.querySelector(this.queryStr+e),n=Re.ifElse(function(e){return e===r},function(e){e.classList.add(t)},function(e){e.classList.remove(t)});this.elArr.map(n)}query(e){if(null!==this.el.querySelector(e))return new Pe(this.el,e);var t=this.el.getAttribute("id");console.warn('Spyne Warning: the element, "'+e+'" does not exist in this element, "'+t+'"!')}getEl(){return this.el}get elArr(){return"NodeList"===this.el.constructor.name?Pe.createArrayFromNodeList(this.el):[].concat(this.el)}unmount(){this.el=void 0,this.cList=void 0,this.inline=void 0}}var Le=r(1),Me=r(0);class Ve{constructor(e){var t=this;void 0===e&&(e={}),this.checker=Math.random(),this.addMixins(),this.defaults=function(){var r=t.createId(),n=e.id?e.id:r;return{cid:r,id:n,tagName:"div",el:void 0,data:void 0,animateIn:!1,animateInTime:.5,animateOut:!1,animateOutTime:.5,hashId:"#"+n,viewClass:be,extendedSourcesHashMethods:{},debug:!1,template:void 0,node:document.createDocumentFragment(),name:i(t)}},this._state={},this.$dirs=fe.createDirectionalFiltersObject(),this.addDefaultDirection=fe.addDefaultDir,this.addDownInternalDir=fe.addDownInternalDir,this.props=P(this.defaults(),e),this.props.domAttributes=Me.pick(["id","class","dataset"],this.props),this.loadEnhancers(),this.loadAllMethods(),this.props.action="LOADED",this.sink$=new Le.Subject;var r=this.props.viewClass;this.view=new r(this.sink$,{},this.props.cid,this.constructor.name),this.sourceStreams=this.view.sourceStreams,this._rawSource$=this.view.getSourceStream(),this._rawSource$.viewName=this.props.name,this.sendEventsDownStream=this.sendEventsDownStreamFn,this.init(),this.checkIfElementAlreadyExists()}checkIfElementAlreadyExists(){Me.propSatisfies(Me.allPass([function(e){return document.body.contains(e)},function(e){return void 0!==e&&void 0!==e.tagName}]),"el")(this.props)&&this.postRender()}loadEnhancers(e){void 0===e&&(e=[]);var t=new Ce(this,e);this.props.enhancersMap=t.getEnhancersMap(),t=void 0}loadAllMethods(){var e=this,t=Me.curry(this.onChannelMethodCall.bind(this));this.addActionListeners().forEach(function(r){var n=r[0],i=r[1],o=r[2],a=Me.defaultTo("LOCAL");e.props.extendedSourcesHashMethods[n]=t(i,a(o))}),this.props.hashSourceMethods=this.setSourceHashMethods(this.props.extendedSourcesHashMethods)}addActionListeners(){return[]}onChannelMethodCall(e,t,r){if(void 0!==r.$dir&&r.$dir.includes("child")&&!0!==this.deleted){var n=P({},r);n.$dir=this.$dirs.C,this.sourceStreams.raw$.next(n)}var i=this.props.enhancersMap.get(t);!1===Me.contains(e,i)?console.warn('Spyne Warning: The method, "'+e+'", does not appear to exist in '+t+" file! "):this[e](r)}setSourceHashMethods(e){var t=this;void 0===e&&(e={});var r={DISPOSING:function(e){return t.checkParentDispose(e)},DISPOSE:function(e){return t.onDispose(e)},RENDERED:function(e){return t.onRendered(e)},RENDERED_AND_ATTACHED_TO_DOM:function(e){return t.onRendered(e)},RENDERED_AND_ATTACHED_TO_PARENT:function(e){return t.onRendered(e)},READY_FOR_GC:function(e){return t.onReadyToGC(e)},NOTHING:function(){return{}}};return P.all([{},r,e])}init(){var e=this;this._source$=this._rawSource$.map(function(t){return e.onMapViewSource(t)}).takeWhile(this.notGCSTATE),this.initAutoMergeSourceStreams(),this.updateSourceSubscription(this._source$,!0)}notGCSTATE(e){return!e.action.includes("READY_FOR_GC")}eqGCSTATE(e){return!e.action.includes("READY_FOR_GC")}notCOMPLETED(e){return!e.action.includes("COMPLETED")}notGCCOMPLETE(e){return!e.action.includes("GC_COMPLETE")}testVal(e){console.log("TESTING VALL IS ",e)}addParentStream(e,t){var r=this;this.parent$=e.filter(function(e){return void 0!==e&&void 0!==e.action}).map(function(e){var t=P({},e);return"DISPOSE_AND_READY_FOR_GC"===t.action&&(r.onDispose(t),t.action="READY_FOR_GC"),t}).takeWhile(this.notGCCOMPLETE),this.updateSourceSubscription(this.parent$,!1,"PARENT"),this.renderAndAttachToParent(t)}addChildStream(e){var t=this,r=e.filter(function(e){return void 0!==e&&void 0!==e.action}).do(function(e){return t.tracer("addChildStraem do ",e)}).map(function(e){return e}).finally(function(e){return t.onChildCompleted(r.source)});this.updateSourceSubscription(r,!0,"CHILD")}onChildDisposed(e){}onChildCompleted(e){var t,r=(t=e,Me.pick(["viewName","cid"],function e(t){for(;void 0!==t.destination;)t=e(t.destination);return t}(t)));return this.tracer("onChildCompleted ",this.checker,e),this.onChildDisposed(r,e),r}initAutoMergeSourceStreams(){var e=this,t={next:this.onSubscribeToSourcesNext.bind(this),error:this.onSubscribeToSourcesError.bind(this),complete:this.onSubscribeToSourcesComplete.bind(this)},r=function(){0===(n-=1)&&(e.props.el$.unmount(),e.uberSource$.complete(),e.autoSubscriber$.complete(),e.sink$.complete(),e.props=void 0,e.deleted=!0,e.tracer("completeAll",e.deleted,e.props))},n=0;this.uberSource$=new Le.Subject;this.autoMergeSubject$=this.uberSource$.mergeMap(function(t){var i=t.observable.filter(function(e){return void 0!==e&&void 0!==e.action}).map(function(t){var r=P({},t);return r.action=t.action,e.tracer("autoMergeSubject$",r),r});return!1===t.autoClosesBool?i:(n+=1,i.finally(r))}),this.autoSubscriber$=this.autoMergeSubject$.filter(function(e){return void 0!==e&&void 0!==e.action}).subscribe(t)}updateSourceSubscription(e,t,r){void 0===t&&(t=!1);var n={observable:e,autoClosesBool:t,rel:r};this.tracer("updateSourceSubscription ",this.checker,n),this.uberSource$.next(n)}onSubscribeToSourcesNext(e){var t=this;void 0===e&&(e={});var r=Me.defaultTo(function(e){return t.sendExtendedStreams(e)}),n=o(this.props.hashSourceMethods,e.action);r(this.props.hashSourceMethods[n])(e),this.tracer("onSubscribeToSourcesNext",{payload:e})}onSubscribeToSourcesError(e){void 0===e&&(e=""),console.log("ALL ERROR  ",this.constructor.name,e)}onSubscribeToSourcesComplete(){this.tracer("onSubscribeToSourcesComplete","GARBAGE_COLLECT"),this.openSpigot("GARBAGE_COLLECT")}get source$(){return this._source$}sendExtendedStreams(e){this.tracer("sendExtendedStreams",e),this.openSpigot(e.action,e)}renderAndAttachToParent(e){this.openSpigot("RENDER_AND_ATTACH_TO_PARENT",e)}renderView(){this.openSpigot("RENDER")}renderViewAndAttachToDom(e,t,r){var n={node:e,type:t,attachType:r};this.openSpigot("RENDER_AND_ATTACH_TO_DOM",{attachData:n})}attachChildToView(e){}checkParentDispose(e){"parent"===e.from$&&this.onDispose(e)}onBeforeDispose(){}onDispose(e){this.onBeforeDispose(),this.openSpigot("DISPOSE")}onChildDispose(e){}onParentDisposing(e){this.openSpigot("DISPOSE")}onReadyToGC(e){var t=void 0!==e.from$&&"internal"===e.from$;this.tracer("onReadyToGC",t,e)}sendEventsDownStreamFn(e,t){void 0===t&&(t={});var r=P({action:t},e);r.$dir=this.$dirs.C,this.sourceStreams.raw$.next(r)}openSpigot(e,t){if(void 0===t&&(t={}),void 0!==this.props){this.props.action=e;var r=Me.merge(this.props,t);this.sink$.next(Object.freeze(r))}}setAttachData(e,t){return{node:this.props.el,type:"ViewToDomMediator",attachType:e,query:this.props.el.querySelector(t)}}getParentEls(e,t){for(var r=function(e){return e.parentElement},n=0,i=e;n<t;)i=r(i),n++;return i}setAttachParentData(e,t,r){return{node:this.getParentEls(this.props.el,r),type:"ViewToDomMediator",attachType:e,query:this.props.el.parentElement.querySelector(t)}}onMapViewSource(e){return void 0===e&&(e={}),this.props=Me.merge(this.props,e),e}exchangeViewsWithChild(e,t){this.addChildStream(e.sourceStreams.toParent$),e.addParentStream(this.sourceStreams.toChild$,t)}appendToDom(e){this.renderViewAndAttachToDom(e,"dom","appendChild")}prependToDom(e){this.renderViewAndAttachToDom(e,"dom","prependChild")}appendView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("appendChild",t))}appendViewToParent(e,t,r){void 0===r&&(r=1),this.exchangeViewsWithChild(e,this.setAttachParentData("appendChild",t,r))}prependViewToParent(e,t,r){void 0===r&&(r=1),this.exchangeViewsWithChild(e,this.setAttachParentData("prependChild",t,r))}prependView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("prependChild",t))}appendToNull(){var e=document.getElementById("spyne-null-views");this.renderViewAndAttachToDom(e,"dom","appendChild")}onRendered(e){"internal"===e.from$&&this.postRender()}postRender(){this.beforeAfterRender(),this.afterRender(),this.viewsStreamBroadcaster=new Ie(this.props,this.broadcastEvents)}beforeAfterRender(){this.props.el$=new Pe(this.props.el)}downStream(){}afterRender(){}broadcastEvents(){return[]}getChannel(e){var t=this;return Me.ifElse(function(e){return f().includes(e)},function(e){return window.Spyne.channels.getStream(e).observer.takeWhile(function(e){return!0!==t.deleted})},function(e){return console.warn("channel name "+e+" is not within "+f)})(e)}addChannel(e,t,r){var n=this;void 0===t&&(t=!1),void 0===r&&(r=!1);var i=!0===t?this.$dirs.CI:this.$dirs.I,o=Me.path(["srcElement","isLocalEvent"]),a=Me.path(["srcElement","cid"]),s=this.getChannel(e).map(function(e){var t=Me.defaultTo({},Me.clone(e));return P({$dir:i},t)}).filter(function(e){var t=a(e);return!0!==o(e)||t===n.props.cid});this.updateSourceSubscription(s,!1)}sendChannelPayload(e,t,r){void 0===t&&(t={}),void 0===r&&(r="VIEWSTREAM_EVENT");var n={payload:t,action:r,srcElement:{}};n.srcElement.cid=this.props.id,n.srcElement.isLocalEvent=!1,n.srcElement.viewName=this.props.name;var i=Le.Observable.of(n);return new Se(e,i,n)}tracer(){}isLocalEvent(e){return void 0!==Me.path(["srcElement","el"],e)&&this.props.el.contains(e.srcElement.el)}addMixins(){var e=se();this.createId=e.createId,this.createpropsMap=e.createpropsMap,this.convertDomStringMapToObj=a,this.ifNilThenUpdate=c;var t=_e();this.sendUIPayload=t.sendUIPayload,this.sendRoutePayload=t.sendRoutePayload,this.createLifeStreamPayload=t.createLifeStreamPayload}}var He=r(0);class Fe{constructor(e){this.parentViewStream=e,this.omittedMethods=["autoBinder","initAutoBinder","getEnhancerMethods","bindParentViewStream"]}initAutoBinder(){this.autoBinder()}getEnhancerMethods(){return l(this,this.omittedMethods)}bindParentViewStream(e,t){var r=this,n=function(e,n){void 0===n&&(n=!1);var i,o=!0===n?r.constructor:r;"function"===typeof o[e]&&(t[i=e]=o[i].bind(t))},i=He.curryN(2,n)(He.__,!0);He.forEach(i,e.staticMethods),He.forEach(n,e.methods)}autoBinder(){var e=this.getEnhancerMethods();this.bindParentViewStream(e,this.parentViewStream)}}var We=r(1),xe=r.n(We);r(4);class Ue extends V{constructor(e){void 0===e&&(e={}),super(e),this.props=e,this.observer$=new xe.a.AsyncSubject,this.fetchData()}get observer(){return this.observer$}addRegisteredActions(){return["CHANNEL_DATA_EVENT"]}fetchData(){var e=this,t=void 0!==this.props.map?this.props.map:function(e){return e};xe.a.Observable.fromPromise(window.fetch(this.props.dataUrl)).flatMap(function(e){return xe.a.Observable.fromPromise(e.json())}).map(t).map(function(t){return new O(e.props.name,"CHANNEL_DATA_EVENT",t)}).multicast(this.observer$).connect()}}r.d(t,"SpyneApp",function(){return je}),r.d(t,"ViewToDomMediator",function(){return be}),r.d(t,"ChannelsBase",function(){return V}),r.d(t,"ChannelsBaseData",function(){return Ue}),r.d(t,"ChannelsBaseController",function(){return ae}),r.d(t,"ChannelsPayload",function(){return Se}),r.d(t,"ChannelStreamItem",function(){return O}),r.d(t,"DomItem",function(){return he}),r.d(t,"ViewStream",function(){return Ve}),r.d(t,"ViewStreamBroadcaster",function(){return Ie}),r.d(t,"ViewStreamEnhancer",function(){return Fe});class je{constructor(e){var t=this;void 0===e&&(e={}),this.channels=new ae,this.VERSION="0.8.0",this.ViewStream=Ve,this.BasicView=be,this.DomItem=he,this.ViewStreamBroadcaster=Ie,this.ChannelsPayload=Se,this.ChannelsBaseController=ae,this.ChannelsBase=V,this.ChannelStreamItem=O,window.Spyne=this;void 0!==e&&(window.Spyne.config=P({channels:{WINDOW:{mediqQueries:{},events:[],listenForResize:!0,listenForOrientation:!0,listenForScroll:!0,listenForMouseWheel:!1,debounceMSTimeForResize:200,debounceMSTimeForScroll:150},ROUTE:{type:"slash",isHash:!1,isHidden:!1,routes:{route:{keyword:"change"}}}}},e)),this.getChannelActions=function(e){return window.Spyne.channels.getChannelActions(e)},this.registerChannel=function(e,r){return t.channels.registerStream(e,r)},this.registerDataChannel=function(e){return t.channels.registerStream(e.props.name,e)};var r=new Ve({id:"spyne-null-views"});r.appendToDom(document.body),r.props.el.style.cssText="display:none; opacity:0; pointer-events:none;",this.channels.init()}static getChannelActions(e){return window.Spyne.channels.getChannelActions(e)}static registerChannel(e,t){if(void 0!==window.Spyne)return window.Spyne.channels.registerStream(e,t);console.warn("Spyne has not been initialized")}}window.Spyne=je},function(e,t){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],n=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};d.prototype.append=function(e,t){e=s(e),t=c(t);var r=this.map[e];this.map[e]=r?r+","+t:t},d.prototype.delete=function(e){delete this.map[s(e)]},d.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},d.prototype.set=function(e,t){this.map[s(e)]=c(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),u(e)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},d.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),u(e)},t.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},f.call(v.prototype),f.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];b.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},e.Headers=d,e.Request=v,e.Response=b,e.fetch=function(e,r){return new Promise(function(n,i){var o=new v(e,r),a=new XMLHttpRequest;a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;n(new b(i,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials&&(a.withCredentials=!0),"responseType"in a&&t.blob&&(a.responseType="blob"),o.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var r={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(r[Symbol.iterator]=function(){return r}),r}function d(e){this.map={},e instanceof d?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function p(e){var t=new FileReader,r=l(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&n(e))this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=m(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?h(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e,t,r,n=h(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=l(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(E)}),this.json=function(){return this.text().then(JSON.parse)},this}function v(e,t){var r,n,i=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),o.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function E(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function b(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},function(e,t){e.exports=o;var r=Object.create,n=function(){throw new Error("Not implemented.")},i=function(){return this};function o(){}function a(e){this.value=e}function s(e){this.value=e}a.prototype=r(o.prototype),s.prototype=r(o.prototype),o.Failure=function(e){return new a(e)},o.prototype.Failure=o.Failure,o.Success=function(e){return new s(e)},o.prototype.Success=o.Success,o.fromNullable=function(e){return null!=e?new s(e):new a(e)},o.prototype.fromNullable=o.fromNullable,o.fromEither=function(e){return e.fold(o.Failure,o.Success)},o.prototype.isFailure=!1,a.prototype.isFailure=!0,o.prototype.isSuccess=!1,s.prototype.isSuccess=!0,o.of=function(e){return new s(e)},o.prototype.of=o.of,o.prototype.ap=n,a.prototype.ap=function(e){return e.isFailure?this.Failure(this.value.concat(e.value)):this},s.prototype.ap=function(e){return e.isFailure?e:e.map(this.value)},o.prototype.map=n,a.prototype.map=i,s.prototype.map=function(e){return this.of(e(this.value))},o.prototype.toString=n,a.prototype.toString=function(){return"Validation.Failure("+this.value+")"},s.prototype.toString=function(){return"Validation.Success("+this.value+")"},o.prototype.isEqual=n,a.prototype.isEqual=function(e){return e.isFailure&&e.value===this.value},s.prototype.isEqual=function(e){return e.isSuccess&&e.value===this.value},o.prototype.get=n,a.prototype.get=function(){throw new TypeError("Can't extract the value of a Failure(a).")},s.prototype.get=function(){return this.value},o.prototype.getOrElse=n,a.prototype.getOrElse=function(e){return e},s.prototype.getOrElse=function(e){return this.value},o.prototype.orElse=n,s.prototype.orElse=i,a.prototype.orElse=function(e){return e(this.value)},o.prototype.merge=function(){return this.value},o.prototype.fold=n,a.prototype.fold=function(e,t){return e(this.value)},s.prototype.fold=function(e,t){return t(this.value)},o.prototype.cata=n,a.prototype.cata=function(e){return e.Failure(this.value)},s.prototype.cata=function(e){return e.Success(this.value)},o.prototype.swap=n,a.prototype.swap=function(){return this.Success(this.value)},s.prototype.swap=function(){return this.Failure(this.value)},o.prototype.bimap=n,a.prototype.bimap=function(e,t){return this.Failure(e(this.value))},s.prototype.bimap=function(e,t){return this.Success(t(this.value))},o.prototype.failureMap=n,s.prototype.failureMap=i,a.prototype.failureMap=function(e){return this.Failure(e(this.value))},o.prototype.leftMap=o.prototype.failureMap,s.prototype.leftMap=s.prototype.failureMap,a.prototype.leftMap=a.prototype.failureMap}])});